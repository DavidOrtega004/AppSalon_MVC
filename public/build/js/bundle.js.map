{"version":3,"sources":["app.js"],"names":["paso","pasoInicial","pasoFinal","cita","id","nombre","fecha","hora","servicios","iniciarApp","mostrarSeccion","tabs","botonesPaginador","paginaSiguiente","paginaAnterior","consultarAPI","idCliente","nombreCliente","seleccionarFecha","seleccionrHora","seccionAnterior","document","querySelector","classList","remove","add","tabAnterior","querySelectorAll","forEach","boton","addEventListener","e","parseInt","target","dataset","mostrarResumen","async","url","resultado","fetch","mostrarServicios","json","error","servicio","precio","nombreServicio","createElement","textContent","precioServicio","servicioDiv","idServicio","onclick","seleccionarServicio","appendChild","divServicio","some","agregado","filter","value","event","dia","Date","getUTCDay","includes","mostrarAlerta","mensaje","tipo","elemento","desaparece","alertaPrevia","alerta","setTimeout","split","resumen","firstChild","removeChild","Object","values","length","headingCita","innerHTML","fechaObj","mes","getMonth","getDate","year","getFullYear","fechaFormateada","UTC","toLocaleDateString","weekday","month","day","fechaCita","horaCita","headingServicios","contenedorServicio","textoServicio","botonReservar","reservarCita","idServicios","map","datos","FormData","append","respuesta","method","body","Swal","fire","icon","title","text","button","then","window","location","reload"],"mappings":"AAAA,IAAAA,KAAA,EACA,MAAAC,YAAA,EACAC,UAAA,EAEAC,KAAA,CACAC,GAAA,GACAC,OAAA,GACAC,MAAA,GACAC,KAAA,GACAC,UAAA,IAOA,SAAAC,aACAC,iBACAC,OACAC,mBACAC,kBACAC,iBAEAC,eAEAC,YACAC,gBACAC,mBACAC,iBAIA,SAAAT,iBAEA,MAAAU,EAAAC,SAAAC,cAAA,YACAF,GACAA,EAAAG,UAAAC,OAAA,WAIAH,SAAAC,cAAA,SAAAtB,MACAuB,UAAAE,IAAA,WAGA,MAAAC,EAAAL,SAAAC,cAAA,WACAI,GACAA,EAAAH,UAAAC,OAAA,UAIAH,SAAAC,cAAA,iBAAAtB,UACAuB,UAAAE,IAAA,UAIA,SAAAd,OACAU,SAAAM,iBAAA,gBAEAC,QAAAC,IACAA,EAAAC,iBAAA,SAAA,SAAAC,GACA/B,KAAAgC,SAAAD,EAAAE,OAAAC,QAAAlC,MACAU,iBACAE,wBAKA,SAAAA,mBACA,MAAAE,EAAAO,SAAAC,cAAA,aACAT,EAAAQ,SAAAC,cAAA,cAEA,IAAAtB,MACAc,EAAAS,UAAAE,IAAA,WACAZ,EAAAU,UAAAC,OAAA,YACA,IAAAxB,MACAc,EAAAS,UAAAC,OAAA,WACAX,EAAAU,UAAAE,IAAA,WACAU,mBAEArB,EAAAS,UAAAC,OAAA,WACAX,EAAAU,UAAAC,OAAA,YAGAd,iBAGA,SAAAI,iBACAO,SAAAC,cAAA,aACAQ,iBAAA,SAAA,WACA9B,MAxFA,IAyFAA,OACAY,uBAIA,SAAAC,kBACAQ,SAAAC,cAAA,cACAQ,iBAAA,SAAA,WACA9B,MAhGA,IAiGAA,OACAY,uBAIAwB,eAAArB,eACA,IACA,MAAAsB,EAAA,sCACAC,QAAAC,MAAAF,GAEAG,uBADAF,EAAAG,QAEA,MAAAC,KAKA,SAAAF,iBAAAhC,GACAA,EAAAoB,QAAAe,IACA,MAAAvC,GAAAA,EAAAC,OAAAA,EAAAuC,OAAAA,GAAAD,EAEAE,EAAAxB,SAAAyB,cAAA,KACAD,EAAAtB,UAAAE,IAAA,mBACAoB,EAAAE,YAAA1C,EAEA,MAAA2C,EAAA3B,SAAAyB,cAAA,KACAE,EAAAzB,UAAAE,IAAA,mBACAuB,EAAAD,YAAA,IAAAH,EAEA,MAAAK,EAAA5B,SAAAyB,cAAA,OACAG,EAAA1B,UAAAE,IAAA,YACAwB,EAAAf,QAAAgB,WAAA9C,EACA6C,EAAAE,QAAA,WACAC,oBAAAT,IAGAM,EAAAI,YAAAR,GACAI,EAAAI,YAAAL,GAEA3B,SAAAC,cAAA,cAAA+B,YAAAJ,KAIA,SAAAG,oBAAAT,GACA,MAAAvC,GAAAA,GAAAuC,GACAnC,UAAAA,GAAAL,KAGAmD,EAAAjC,SAAAC,cAAA,sBAAAlB,OAGAI,EAAA+C,KAAAC,GAAAA,EAAApD,KAAAuC,EAAAvC,KAEAD,KAAAK,UAAAA,EAAAiD,OAAAD,GAAAA,EAAApD,KAAAA,GACAkD,EAAA/B,UAAAC,OAAA,kBAGArB,KAAAK,UAAA,IAAAA,EAAAmC,GACAW,EAAA/B,UAAAE,IAAA,iBAMA,SAAAT,YACAb,KAAAC,GAAAiB,SAAAC,cAAA,OAAAoC,MAGA,SAAAzC,gBACAd,KAAAE,OAAAgB,SAAAC,cAAA,WAAAoC,MAGA,SAAAxC,mBACAG,SAAAC,cAAA,UACAQ,iBAAA,SAAA,SAAA6B,GACA,MAAAC,EAAA,IAAAC,KAAAF,EAAA1B,OAAAyB,OAAAI,YAEA,CAAA,EAAA,GAAAC,SAAAH,IACAD,EAAA1B,OAAAyB,MAAA,GACAM,cAAA,gCAAA,QAAA,gBAEA7D,KAAAG,MAAAqD,EAAA1B,OAAAyB,SAKA,SAAAM,cAAAC,EAAAC,EAAAC,EAAAC,GAAA,GAEA,MAAAC,EAAAhD,SAAAC,cAAA,WACA+C,GACAA,EAAA7C,SAGA,MAAA8C,EAAAjD,SAAAyB,cAAA,OACAwB,EAAAvB,YAAAkB,EACAK,EAAA/C,UAAAE,IAAA,UACA6C,EAAA/C,UAAAE,IAAAyC,GAEA7C,SAAAC,cAAA6C,GACAd,YAAAiB,GACAF,GACAG,WAAA,KACAD,EAAA9C,UACA,KAIA,SAAAL,iBACAE,SAAAC,cAAA,SACAQ,iBAAA,SAAA,SAAA6B,GACA,MACApD,EADAoD,EAAA1B,OAAAyB,MACAc,MAAA,KAAA,GACAjE,EAAA,IAAAA,EAAA,IACAoD,EAAA1B,OAAAyB,MAAA,GACAM,cAAA,iBAAA,QAAA,gBAEA7D,KAAAI,KAAAoD,EAAA1B,OAAAyB,SAKA,SAAAvB,iBACA,MAAAsC,EAAApD,SAAAC,cAAA,sBAEA,KAAAmD,EAAAC,YACAD,EAAAE,YAAAF,EAAAC,YAEA,GAAAE,OAAAC,OAAA1E,MAAA4D,SAAA,KAAA,IAAA5D,KAAAK,UAAAsE,OAEA,YADAd,cAAA,0DAAA,QAAA,sBAAA,GAMA,MAAAe,EAAA1D,SAAAyB,cAAA,MACAiC,EAAAhC,YAAA,kBAIA,MAAA1C,OAAAA,EAAAC,MAAAA,EAAAC,KAAAA,EAAAC,UAAAA,GAAAL,KAEAc,EAAAI,SAAAyB,cAAA,KACA7B,EAAA+D,UAAA,wBAAA3E,EAGA,MAAA4E,EAAA,IAAApB,KAAAvD,GACA4E,EAAAD,EAAAE,WACAvB,EAAAqB,EAAAG,UAAA,EACAC,EAAAJ,EAAAK,cAIAC,EAHA,IAAA1B,KAAAA,KAAA2B,IAAAH,EAAAH,EAAAtB,IAGA6B,mBAAA,QADA,CAAAC,QAAA,OAAAL,KAAA,UAAAM,MAAA,OAAAC,IAAA,YAEAC,EAAAxE,SAAAyB,cAAA,KACA+C,EAAAb,UAAA,wBAAAO,EAEA,MAAAO,EAAAzE,SAAAyB,cAAA,KACAgD,EAAAd,UAAA,sBAAAzE,EAGA,MAAAwF,EAAA1E,SAAAyB,cAAA,MACAiD,EAAAhD,YAAA,uBAEA0B,EAAApB,YAAA0B,GACAN,EAAApB,YAAApC,GACAwD,EAAApB,YAAAwC,GACApB,EAAApB,YAAAyC,GACArB,EAAApB,YAAA0C,GAGAvF,EAAAoB,QAAAe,IACA,MAAAvC,GAAAA,EAAAwC,OAAAA,EAAAvC,OAAAA,GAAAsC,EACAqD,EAAA3E,SAAAyB,cAAA,OACAkD,EAAAzE,UAAAE,IAAA,uBAEA,MAAAwE,EAAA5E,SAAAyB,cAAA,KACAmD,EAAAlD,YAAA1C,EAEA,MAAA2C,EAAA3B,SAAAyB,cAAA,KACAE,EAAAgC,UAAA,yBAAApC,EAEAoD,EAAA3C,YAAA4C,GACAD,EAAA3C,YAAAL,GAEAyB,EAAApB,YAAA2C,KAIA,MAAAE,EAAA7E,SAAAyB,cAAA,UACAoD,EAAA3E,UAAAE,IAAA,SACAyE,EAAAnD,YAAA,gBACAmD,EAAA/C,QAAAgD,aAEA1B,EAAApB,YAAA6C,GAGA9D,eAAA+D,eACA,MAAA9F,OAAAA,EAAAC,MAAAA,EAAAC,KAAAA,EAAAC,UAAAA,EAAAJ,GAAAA,GAAAD,KACAiG,EAAA5F,EAAA6F,IAAA1D,GAAAA,EAAAvC,IAEAkG,EAAA,IAAAC,SACAD,EAAAE,OAAA,QAAAlG,GACAgG,EAAAE,OAAA,OAAAjG,GACA+F,EAAAE,OAAA,YAAApG,GACAkG,EAAAE,OAAA,YAAAJ,GAEA,IAEA,MAAA/D,EAAA,kCACAoE,QAAAlE,MAAAF,EAAA,CACAqE,OAAA,OACAC,KAAAL,WAGAG,EAAAhE,QAEAH,WACAsE,KAAAC,KAAA,CACAC,KAAA,UACAC,MAAA,cACAC,KAAA,oCACAC,OAAA,OACAC,KAAA,KACA3C,WAAA4C,OAAAC,SAAAC,SAAA,OAGA,MAAA3E,GACAkE,KAAAC,KAAA,CACAC,KAAA,QACAC,MAAA,WACAC,KAAA,oFAEAtE,uBAEAuE,OAAA,QAhUA5F,SAAAS,iBAAA,oBAAA,WACArB","file":"bundle.js","sourcesContent":["let paso = 1;\r\nconst pasoInicial = 1;\r\nconst pasoFinal = 3;\r\n\r\nconst cita = {\r\n    id: '',\r\n    nombre: '',\r\n    fecha: '',\r\n    hora: '',\r\n    servicios: []\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', function(){\r\n    iniciarApp();\r\n});\r\n\r\nfunction iniciarApp() {\r\n    mostrarSeccion(); // Muestra y oculta las secciones\r\n    tabs(); // Cambia la sección cuando se presione los tabs\r\n    botonesPaginador(); // Agrega o quita los botones del paginador\r\n    paginaSiguiente();\r\n    paginaAnterior();\r\n\r\n    consultarAPI(); // COnsulta la API en el backen de PHP\r\n\r\n    idCliente();\r\n    nombreCliente(); // Añade el nombre del cliente al obj\r\n    seleccionarFecha(); // Añade la fecha de la cita en el obj\r\n    seleccionrHora(); // Añade la hora de la cita en el obj\r\n\r\n}\r\n\r\nfunction mostrarSeccion() {\r\n    // Ocultar la sección que tenga la clase mostrar\r\n    const seccionAnterior = document.querySelector('.mostrar');\r\n    if(seccionAnterior){\r\n        seccionAnterior.classList.remove('mostrar');\r\n    }\r\n\r\n    //Seleccionar la seccion con el paso\r\n    const seccion = document.querySelector(`#paso-${paso}`);\r\n    seccion.classList.add('mostrar');\r\n    \r\n    // Quita la clase actual a la sección anterior\r\n    const tabAnterior = document.querySelector('.actual');\r\n    if(tabAnterior){\r\n        tabAnterior.classList.remove('actual');\r\n    }\r\n\r\n    // Resalta la etapa actual\r\n    const tab= document.querySelector(`[data-paso = \"${paso}\"]`);\r\n    tab.classList.add('actual');\r\n\r\n}\r\n\r\nfunction tabs() {\r\n    const botones = document.querySelectorAll('.tabs button');\r\n\r\n    botones.forEach( boton => {\r\n        boton.addEventListener('click', function (e) {\r\n            paso = parseInt(e.target.dataset.paso);\r\n            mostrarSeccion();\r\n            botonesPaginador();\r\n        });\r\n    });\r\n}\r\n\r\nfunction botonesPaginador() {\r\n    const paginaAnterior = document.querySelector('#anterior');\r\n    const paginaSiguiente = document.querySelector('#siguiente');\r\n\r\n    if( paso === 1 ){\r\n        paginaAnterior.classList.add('ocultar');\r\n        paginaSiguiente.classList.remove('ocultar');\r\n    }else if( paso === 3 ){\r\n        paginaAnterior.classList.remove('ocultar');\r\n        paginaSiguiente.classList.add('ocultar');\r\n        mostrarResumen();\r\n    }else{\r\n        paginaAnterior.classList.remove('ocultar');\r\n        paginaSiguiente.classList.remove('ocultar');\r\n\r\n    }\r\n    mostrarSeccion();\r\n}\r\n\r\nfunction paginaAnterior() {\r\n    const paginaAnterior = document.querySelector('#anterior');\r\n    paginaAnterior.addEventListener('click', function () {\r\n        if(paso <= pasoInicial) return;\r\n        paso--;\r\n        botonesPaginador();\r\n    });\r\n}\r\n\r\nfunction paginaSiguiente() {\r\n    const paginaSiguiente = document.querySelector('#siguiente');\r\n    paginaSiguiente.addEventListener('click', function () {\r\n        if(paso >= pasoFinal) return;\r\n        paso++;\r\n        botonesPaginador();\r\n    });\r\n}\r\n\r\nasync function consultarAPI() {\r\n    try {\r\n        const url = 'http://127.0.0.1:3000/api/servicios';\r\n        const resultado = await fetch(url);\r\n        const servicios = await resultado.json();\r\n        mostrarServicios(servicios);\r\n    } catch (error) {\r\n        \r\n    }\r\n}\r\n\r\nfunction mostrarServicios(servicios) {\r\n    servicios.forEach(servicio => {\r\n        const { id, nombre, precio } = servicio;\r\n\r\n        const nombreServicio = document.createElement('P');\r\n        nombreServicio.classList.add('nombre-servicio');\r\n        nombreServicio.textContent = nombre;\r\n\r\n        const precioServicio = document.createElement('P');\r\n        precioServicio.classList.add('precio-servicio');\r\n        precioServicio.textContent = `$${precio}`;\r\n\r\n        const servicioDiv = document.createElement('DIV');\r\n        servicioDiv.classList.add('servicio');\r\n        servicioDiv.dataset.idServicio = id;\r\n        servicioDiv.onclick = function () {\r\n            seleccionarServicio(servicio);\r\n        }\r\n\r\n        servicioDiv.appendChild(nombreServicio);\r\n        servicioDiv.appendChild(precioServicio);\r\n\r\n        document.querySelector('#servicios').appendChild(servicioDiv);\r\n    });\r\n}\r\n\r\nfunction seleccionarServicio(servicio) {\r\n    const { id } = servicio;\r\n    const { servicios } = cita;\r\n    \r\n    // Identifica al elemento\r\n    const divServicio = document.querySelector(`[data-id-servicio=\"${id}\"]`);\r\n \r\n    // Comprueba si un servicio ya esta seleccionado\r\n    if( servicios.some( agregado => agregado.id === servicio.id ) ){\r\n        // Eliminar\r\n        cita.servicios = servicios.filter( agregado => agregado.id !== id);\r\n        divServicio.classList.remove('seleccionado');\r\n    }else{\r\n        // Agregar\r\n        cita.servicios = [...servicios, servicio];\r\n        divServicio.classList.add('seleccionado');\r\n    }\r\n\r\n    \r\n}\r\n\r\nfunction idCliente() {\r\n    cita.id = document.querySelector('#id').value;\r\n}\r\n\r\nfunction nombreCliente() {\r\n    cita.nombre = document.querySelector('#nombre').value;\r\n}\r\n\r\nfunction seleccionarFecha() {\r\n    const inputFecha = document.querySelector('#fecha');\r\n    inputFecha.addEventListener('input', function (event) {\r\n        const dia = new Date(event.target.value).getUTCDay();\r\n        \r\n        if( [6, 0].includes(dia) ){\r\n            event.target.value = '';\r\n            mostrarAlerta('Fines de semana no permitidos', 'error', '.formulario');\r\n        }else{\r\n            cita.fecha = event.target.value;\r\n        }\r\n    });\r\n}\r\n\r\nfunction mostrarAlerta(mensaje, tipo, elemento, desaparece = true) {\r\n    //Previene que se generen más de una alerta\r\n    const alertaPrevia = document.querySelector('.alerta');\r\n    if(alertaPrevia){\r\n        alertaPrevia.remove();\r\n    }\r\n\r\n    const alerta = document.createElement('DIV');\r\n    alerta.textContent = mensaje;\r\n    alerta.classList.add('alerta');\r\n    alerta.classList.add(tipo);\r\n\r\n    const referencia = document.querySelector(elemento);\r\n    referencia.appendChild(alerta);\r\n    if(desaparece){\r\n        setTimeout(() => {\r\n            alerta.remove();\r\n        }, 3000);\r\n    }\r\n}\r\n\r\nfunction seleccionrHora() {\r\n    const inputHora = document.querySelector('#hora');\r\n    inputHora.addEventListener('input', function (event) {\r\n        const horaCita = event.target.value;\r\n        const hora = horaCita.split(\":\")[0];\r\n        if(hora < 10 || hora > 18){\r\n            event.target.value = '';\r\n            mostrarAlerta('Hora no válida', 'error', '.formulario');\r\n        }else{\r\n            cita.hora = event.target.value;\r\n        }\r\n    });\r\n}\r\n\r\nfunction mostrarResumen() {\r\n    const resumen = document.querySelector('.contenido-resumen');\r\n\r\n    while( resumen.firstChild ){\r\n        resumen.removeChild(resumen.firstChild);\r\n    }\r\n    if( Object.values(cita).includes('') || cita.servicios.length === 0){\r\n        mostrarAlerta('Hace falta almenos un Servicio o Información de la cita', 'error', '.contenido-resumen', false);\r\n        return;\r\n    }\r\n\r\n\r\n    // Heading para Cita en Resumen\r\n    const headingCita = document.createElement('H3');\r\n    headingCita.textContent = 'Resumen de Cita'\r\n\r\n\r\n    // Formatear el div de resumen\r\n    const { nombre, fecha, hora, servicios} = cita;\r\n\r\n    const nombreCliente = document.createElement('P');\r\n    nombreCliente.innerHTML = `<span>Nombre:</span> ${nombre}`;\r\n\r\n        // Formatear la fecha\r\n        const fechaObj = new Date(fecha);\r\n        const mes = fechaObj.getMonth();\r\n        const dia = fechaObj.getDate() + 2;\r\n        const year = fechaObj.getFullYear();\r\n        const fechaUTC = new Date( Date.UTC(year, mes, dia) );\r\n\r\n        const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}\r\n        const fechaFormateada = fechaUTC.toLocaleDateString('es-CO', opciones);\r\n    const fechaCita = document.createElement('P');\r\n    fechaCita.innerHTML = `<span>Nombre:</span> ${fechaFormateada}`;\r\n\r\n    const horaCita = document.createElement('P');\r\n    horaCita.innerHTML = `<span>Hora:</span> ${hora}`;\r\n\r\n    // Heading para Servicios en Resumen\r\n    const headingServicios = document.createElement('H3');\r\n    headingServicios.textContent = 'Resumen de Servicios'\r\n\r\n    resumen.appendChild(headingCita);\r\n    resumen.appendChild(nombreCliente);\r\n    resumen.appendChild(fechaCita);\r\n    resumen.appendChild(horaCita);\r\n    resumen.appendChild(headingServicios);\r\n    \r\n    // Iterando y mostrando los serevicios\r\n    servicios.forEach( servicio => {\r\n        const { id, precio, nombre } = servicio;\r\n        const contenedorServicio = document.createElement('DIV');\r\n        contenedorServicio.classList.add('contenedor-servicio');\r\n\r\n        const textoServicio = document.createElement('P');\r\n        textoServicio.textContent = nombre;\r\n\r\n        const precioServicio = document.createElement('P');\r\n        precioServicio.innerHTML = `<span>Precio:</span> $${precio}`;\r\n\r\n        contenedorServicio.appendChild(textoServicio);\r\n        contenedorServicio.appendChild(precioServicio);\r\n\r\n        resumen.appendChild(contenedorServicio);\r\n    });\r\n\r\n    // Botón para crear la cita\r\n    const botonReservar = document.createElement('BUTTON');\r\n    botonReservar.classList.add('boton');\r\n    botonReservar.textContent = 'Reservar cita';\r\n    botonReservar.onclick = reservarCita;\r\n\r\n    resumen.appendChild(botonReservar);\r\n}\r\n\r\nasync function reservarCita() {\r\n    const { nombre, fecha, hora, servicios, id } = cita;\r\n    const idServicios = servicios.map( servicio => servicio.id );\r\n\r\n    const datos = new FormData();\r\n    datos.append('fecha', fecha);\r\n    datos.append('hora', hora);\r\n    datos.append('usuarioId', id);\r\n    datos.append('servicios', idServicios);\r\n\r\n    try {\r\n        // Petición hacia la API\r\n        const url = 'http://127.0.0.1:3000/api/citas';\r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n\r\n        if(resultado.resultado){\r\n            Swal.fire({\r\n                icon: 'success',\r\n                title: 'Cita creada',\r\n                text: 'Tu cita fue creada correctamente.',\r\n                button: 'OK'\r\n            }).then( () => {\r\n                setTimeout(window.location.reload(), 3000);\r\n            })\r\n        }\r\n    } catch (error) {\r\n        Swal.fire({\r\n            icon: 'error',\r\n            title: 'Error :c',\r\n            text: `\r\n                Hubo un error al guardar la cita.\r\n                Referencia: ${error}.\r\n                `,\r\n            button: 'OK'\r\n        })\r\n    }\r\n\r\n    \r\n\r\n    // console.log([...datos]);\r\n}"]}